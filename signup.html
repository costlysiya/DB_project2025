{% extends "base.html" %}

{% block title %}회원가입 | SELECT MARKET{% endblock %}

{% block content %}
    <div class="form-container wide">
        <h2>SELECT MARKET 회원가입</h2>
        <p class="subtitle">서비스 이용을 위해 역할을 선택하고 정보를 입력해주세요.</p>
        
        <form action="/signup" method="POST">
            
            <fieldset class="role-selection">
                <legend>✅ 사용자 역할 선택</legend>
                
                <label>
                    <input type="radio" name="role" value="Buyer" id="role_buyer" required checked>
                    구매자 (Buyer)
                </label>
                
                <label>
                    <input type="radio" name="role" value="PrimarySeller" id="role_primary_seller" required>
                    1차 판매자 (Primary Seller)
                </label>
                
                <label>
                    <input type="radio" name="role" value="Reseller" id="role_reseller" required>
                    2차 판매자 (Reseller)
                </label>
                
                <label>
                    <input type="radio" name="role" value="Administrator" id="role_admin" required>
                    관리자 (Administrator)
                </label>

            </fieldset>

            <hr>

            <div class="form-group-section">
                <h3>필수 공통 정보</h3>
                <div class="form-group">
                    <label for="uid">아이디 (로그인 ID) <span class="required">*</span></label>
                    <input type="text" id="uid" name="uid" placeholder="5~20자 영문/숫자" required>
                </div>

                <div class="form-group">
                    <label for="password">비밀번호 <span class="required">*</span></label>
                    <input type="password" id="password" name="password" required>
                </div>

                <div class="form-group">
                    <label for="name">이름/활동명 <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required>
                </div>
            </div>

            <hr>

            <div id="role-specific-fields">

                <div id="fields_buyer" class="role-fields active">
                    <h3>구매자 추가 정보</h3>
                    <div class="form-group">
                        <label for="address">배송 주소</label>
                        <input type="text" id="address" name="address" placeholder="주소를 입력해주세요 (BuyerProfile)">
                    </div>
                </div>

                <div id="fields_seller" class="role-fields hidden">
                    <h3>판매자 추가 정보</h3>
                    <p class="note">⚠️ 판매자 등급(`grade`)은 관리자 승인 후 부여됩니다.</p>
                    <div class="form-group">
                        <label for="store_name">상점명 (Seller 전용)</label>
                        <input type="text" id="store_name" name="store_name" placeholder="공식 판매자인 경우 상점명을 입력하세요 (SellerProfile)">
                    </div>
                </div>

                <div id="fields_admin" class="role-fields hidden">
                    <h3>관리자 인증</h3>
                    <p class="note">❗ 관리자 계정은 특별 인증이 필요합니다.</p>
                    <div class="form-group">
                        <label for="auth_code">인증번호 <span class="required">*</span></label>
                        <input type="text" id="auth_code" name="auth_code" required placeholder="관리자 전용 인증번호를 입력하세요">
                    </div>
                </div>
            </div>

            <button type="submit" class="btn full-width submit-btn">회원가입 완료</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const roleRadios = document.querySelectorAll('input[name="role"]');
            const buyerFields = document.getElementById('fields_buyer');
            const sellerFields = document.getElementById('fields_seller');
            const adminFields = document.getElementById('fields_admin'); // 새 관리자 필드

            function toggleFields() {
                const selectedRole = document.querySelector('input[name="role"]:checked').value;

                // 모든 필드 숨기기
                document.querySelectorAll('.role-fields').forEach(el => {
                    el.classList.remove('active');
                    el.classList.add('hidden');
                    // 숨길 때 required 속성을 해제하여 폼 제출 오류 방지 (UX 개선)
                    el.querySelectorAll('input').forEach(input => input.removeAttribute('required'));
                });

                if (selectedRole === 'Buyer') {
                    buyerFields.classList.add('active');
                    buyerFields.classList.remove('hidden');
                    // 필요한 필드에 required 속성 추가
                    buyerFields.querySelector('#address').setAttribute('required', 'required');
                } else if (selectedRole === 'PrimarySeller' || selectedRole === 'Reseller') {
                    sellerFields.classList.add('active');
                    sellerFields.classList.remove('hidden');
                    // PrimarySeller만 store_name이 의미 있으나, 일단 폼은 표시
                } else if (selectedRole === 'Administrator') {
                    adminFields.classList.add('active');
                    adminFields.classList.remove('hidden');
                    // 관리자 인증번호에 required 속성 추가
                    adminFields.querySelector('#auth_code').setAttribute('required', 'required');
                }
            }

            roleRadios.forEach(radio => radio.addEventListener('change', toggleFields));
            
            // 초기 로드 시 한 번 실행
            toggleFields();
        });
    </script>
{% endblock %}